<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—Å–∫–æ–≤—Å–∫–∏–π –∫—É—Ä—å–µ—Ä 3D</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            overflow: hidden;
        }

        /* –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loader-container {
            text-align: center;
            color: white;
        }

        .loader {
            width: 80px;
            height: 80px;
            border: 5px solid #333;
            border-top: 5px solid #4cc9f0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 24px;
            margin-bottom: 10px;
            color: #4cc9f0;
        }

        .progress-bar {
            width: 300px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin: 20px auto;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #4cc9f0, #e94560);
            width: 0%;
            transition: width 0.3s;
        }

        #start-button {
            background: linear-gradient(135deg, #4cc9f0, #e94560);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            display: none;
            transition: all 0.3s;
        }

        #start-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.5);
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã */
        #game-container {
            display: none;
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* –¢–µ–ª–µ—Ñ–æ–Ω */
        .phone {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 320px;
            height: 500px;
            background: #111;
            border-radius: 20px;
            padding: 15px;
            pointer-events: all;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            border: 2px solid #333;
        }

        .phone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .phone-title {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .phone-time {
            color: #4cc9f0;
            font-size: 14px;
        }

        .orders-list {
            height: 350px;
            overflow-y: auto;
            margin-bottom: 10px;
        }

        .order {
            background: #222;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #4cc9f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .order:hover {
            background: #2a2a2a;
            transform: translateX(-3px);
        }

        .order.active {
            border-left-color: #e94560;
            background: #2a2a2a;
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .order-title {
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .order-reward {
            color: #ffaa00;
            font-weight: bold;
            font-size: 14px;
        }

        .order-address {
            color: #ccc;
            font-size: 12px;
            margin-bottom: 3px;
        }

        .order-time {
            color: #e94560;
            font-size: 11px;
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 10px;
            min-width: 200px;
            pointer-events: all;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: white;
            font-size: 14px;
        }

        .stat-label {
            color: #aaa;
        }

        .stat-value {
            font-weight: bold;
        }

        .rating {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .stars {
            color: #ffaa00;
            font-size: 18px;
            margin-right: 8px;
        }

        .rating-value {
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        /* –¢–∞–π–º–µ—Ä */
        .timer {
            position: absolute;
            top: 20px;
            right: 350px;
            background: rgba(0,0,0,0.8);
            padding: 10px 15px;
            border-radius: 10px;
            color: #4cc9f0;
            font-size: 20px;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            pointer-events: all;
        }

        /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            pointer-events: all;
        }

        button {
            background: linear-gradient(135deg, #4cc9f0, #e94560);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.3s;
            min-width: 120px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        button:disabled {
            background: #555;
            cursor: not-allowed;
        }

        /* –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
        .direction-pointer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            color: #4cc9f0;
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.8);
            z-index: 50;
            pointer-events: none;
            display: none;
        }

        .distance-display {
            position: absolute;
            top: calc(50% + 40px);
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 14px;
            pointer-events: none;
            display: none;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            text-align: center;
            display: none;
            z-index: 1000;
            min-width: 300px;
            border: 2px solid #4cc9f0;
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.3);
            pointer-events: all;
        }

        .notification h2 {
            color: #4cc9f0;
            margin-bottom: 10px;
            font-size: 20px;
        }

        .notification p {
            color: #ccc;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .notification button {
            background: linear-gradient(135deg, #e94560, #4cc9f0);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }

        /* –ß–∞–µ–≤—ã–µ */
        .tip-notification {
            position: absolute;
            top: 100px;
            right: 20px;
            background: linear-gradient(135deg, #ffaa00, #ff5500);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
            animation: slideIn 0.5s ease-out;
            z-index: 1000;
            pointer-events: none;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* –ú–∞—Ä–∫–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ */
        .map-marker {
            position: absolute;
            width: 24px;
            height: 24px;
            background: #e94560;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 15px #e94560;
            transform: translate(-50%, -50%);
            z-index: 50;
            pointer-events: none;
            animation: pulse 1.5s infinite;
            display: none;
        }

        .map-marker::before {
            content: '';
            position: absolute;
            width: 10px;
            height: 10px;
            background: white;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .map-marker.delivery {
            background: #4cc9f0;
            box-shadow: 0 0 15px #4cc9f0;
        }

        .marker-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            pointer-events: none;
        }

        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ */
        .delivery-zone {
            position: absolute;
            border: 3px dashed #4cc9f0;
            border-radius: 50%;
            pointer-events: none;
            z-index: 49;
            display: none;
            animation: zonePulse 2s infinite;
        }

        @keyframes zonePulse {
            0% { border-color: rgba(76, 201, 240, 0.5); }
            50% { border-color: rgba(76, 201, 240, 1); }
            100% { border-color: rgba(76, 201, 240, 0.5); }
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∫–æ—Ä–æ—Å—Ç–∏ */
        .speedometer {
            position: absolute;
            bottom: 150px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            pointer-events: none;
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Å–∫–æ—Ä–µ–Ω–∏—è */
        .boost-indicator {
            position: absolute;
            top: 100px;
            left: 20px;
            background: rgba(233, 69, 96, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            display: none;
            pointer-events: none;
        }

        /* –ú–µ–Ω—é –ø–∞—É–∑—ã */
        .pause-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            pointer-events: all;
        }

        .pause-title {
            color: #4cc9f0;
            font-size: 36px;
            margin-bottom: 30px;
        }

        .pause-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .pause-btn {
            background: linear-gradient(135deg, #4cc9f0, #e94560);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            min-width: 200px;
            transition: all 0.3s;
        }

        .pause-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(76, 201, 240, 0.5);
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ */
        .controls-info {
            position: absolute;
            bottom: 100px;
            left: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
        }

        .controls-info div {
            margin: 3px 0;
        }

        .controls-info kbd {
            background: #333;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="loading-screen">
        <div class="loader-container">
            <div class="loader"></div>
            <div class="loading-text" id="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
            <div class="progress-bar">
                <div class="progress" id="loading-progress"></div>
            </div>
            <button id="start-button">–ù–ê–ß–ê–¢–¨ –ò–ì–†–£</button>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã -->
    <div id="game-container">
        <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
        <div id="ui">
            <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="stats">
                <div class="stat-row">
                    <span class="stat-label">–ë–∞–ª–∞–Ω—Å:</span>
                    <span class="stat-value" id="balance">1000 ‚ÇΩ</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ:</span>
                    <span class="stat-value" id="delivered">0</span>
                </div>
                <div class="rating">
                    <div class="stars" id="stars">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                    <div class="rating-value" id="rating">5.0</div>
                </div>
                <div class="stat-row">
                    <span class="stat-label">–£—Å–∫–æ—Ä–µ–Ω–∏—è:</span>
                    <span class="stat-value" id="boosts">3</span>
                </div>
            </div>

            <!-- –¢–∞–π–º–µ—Ä -->
            <div class="timer" id="timer">--:--</div>

            <!-- –£–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="direction-pointer" id="direction-pointer">‚û§</div>
            <div class="distance-display" id="distance-display"></div>

            <!-- –°–ø–∏–¥–æ–º–µ—Ç—Ä -->
            <div class="speedometer" id="speedometer">0 –∫–º/—á</div>

            <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —É—Å–∫–æ—Ä–µ–Ω–∏—è -->
            <div class="boost-indicator" id="boost-indicator">üöÄ –£—Å–∫–æ—Ä–µ–Ω–∏–µ!</div>

            <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="controls">
                <button id="accept-btn" onclick="acceptOrder()">–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑</button>
                <button id="complete-btn" onclick="completeDelivery()" disabled>–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                <button id="boost-btn" onclick="useBoost()">–£—Å–∫–æ—Ä–µ–Ω–∏–µ (3)</button>
                <button id="pause-btn" onclick="togglePause()">–ü–∞—É–∑–∞</button>
            </div>

            <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
            <div class="controls-info">
                <div><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> - –î–≤–∏–∂–µ–Ω–∏–µ</div>
                <div><kbd>E</kbd> - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ</div>
                <div><kbd>SPACE</kbd> - –£—Å–∫–æ—Ä–µ–Ω–∏–µ</div>
                <div><kbd>ESC</kbd> - –ü–∞—É–∑–∞</div>
            </div>

            <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
            <div class="phone">
                <div class="phone-header">
                    <div class="phone-title">üì± –ó–∞–∫–∞–∑—ã</div>
                    <div class="phone-time" id="phone-time">12:00</div>
                </div>
                <div class="orders-list" id="orders-list">
                    <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>

            <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —á–∞–µ–≤—ã—Ö -->
            <div class="tip-notification" id="tip-notification"></div>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
            <div class="notification" id="notification">
                <h2 id="notification-title">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
                <p id="notification-text">–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</p>
                <button onclick="closeNotification()">–û–ö</button>
            </div>

            <!-- –ú–µ–Ω—é –ø–∞—É–∑—ã -->
            <div class="pause-menu" id="pause-menu">
                <h1 class="pause-title">–ú–û–°–ö–û–í–°–ö–ò–ô –ö–£–†–¨–ï–†</h1>
                <div class="pause-buttons">
                    <button class="pause-btn" onclick="togglePause()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                    <button class="pause-btn" onclick="restartGame()">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
                    <button class="pause-btn" onclick="showInstructions()">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
        document.addEventListener('DOMContentLoaded', function() {
            const loadingScreen = document.getElementById('loading-screen');
            const gameContainer = document.getElementById('game-container');
            const loadingText = document.getElementById('loading-text');
            const loadingProgress = document.getElementById('loading-progress');
            const startButton = document.getElementById('start-button');
            
            let progress = 0;
            
            // –ò–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
            const loadInterval = setInterval(() => {
                progress += 2;
                loadingProgress.style.width = progress + '%';
                
                if (progress <= 30) {
                    loadingText.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ 3D –¥–≤–∏–∂–∫–∞...";
                } else if (progress <= 60) {
                    loadingText.textContent = "–°–æ–∑–¥–∞–Ω–∏–µ –ú–æ—Å–∫–≤—ã...";
                } else if (progress <= 90) {
                    loadingText.textContent = "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã...";
                } else {
                    loadingText.textContent = "–ì–æ—Ç–æ–≤–æ!";
                    clearInterval(loadInterval);
                    setTimeout(() => {
                        startButton.style.display = 'block';
                    }, 500);
                }
            }, 50);
            
            startButton.addEventListener('click', function() {
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    gameContainer.style.display = 'block';
                    initGame();
                }, 500);
            });
        });

        // –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞
        let scene, camera, renderer;
        let car;
        let keys = {};
        let gameState = {
            balance: 1000,
            delivered: 0,
            rating: 5.0,
            boosts: 3,
            currentOrder: null,
            deliveryTimer: null,
            deliveryTime: 0,
            maxDeliveryTime: 0,
            speed: 0,
            isBoostActive: false,
            isPaused: false,
            playerPosition: { x: 0, z: 0 },
            velocity: { x: 0, z: 0 },
            orders: [
                { 
                    id: 1, 
                    address: "–¢–≤–µ—Ä—Å–∫–∞—è —É–ª–∏—Ü–∞, 10", 
                    reward: 200, 
                    time: 180, 
                    location: { x: 100, z: 0 },
                    zoneRadius: 15
                },
                { 
                    id: 2, 
                    address: "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å, 1", 
                    reward: 250, 
                    time: 120, 
                    location: { x: 40, z: 60 },
                    zoneRadius: 20
                },
                { 
                    id: 3, 
                    address: "–ú–æ—Å–∫–≤–∞-–°–∏—Ç–∏", 
                    reward: 350, 
                    time: 240, 
                    location: { x: -80, z: -70 },
                    zoneRadius: 25
                },
                { 
                    id: 4, 
                    address: "–í–î–ù–•", 
                    reward: 180, 
                    time: 150, 
                    location: { x: 120, z: -50 },
                    zoneRadius: 18
                },
                { 
                    id: 5, 
                    address: "–ü–∞—Ä–∫ –ì–æ—Ä—å–∫–æ–≥–æ", 
                    reward: 150, 
                    time: 90, 
                    location: { x: -30, z: 80 },
                    zoneRadius: 15
                }
            ]
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const balanceEl = document.getElementById('balance');
        const deliveredEl = document.getElementById('delivered');
        const starsEl = document.getElementById('stars');
        const ratingEl = document.getElementById('rating');
        const boostsEl = document.getElementById('boosts');
        const timerEl = document.getElementById('timer');
        const speedometerEl = document.getElementById('speedometer');
        const boostIndicator = document.getElementById('boost-indicator');
        const directionPointer = document.getElementById('direction-pointer');
        const distanceDisplay = document.getElementById('distance-display');
        const ordersListEl = document.getElementById('orders-list');
        const acceptBtn = document.getElementById('accept-btn');
        const completeBtn = document.getElementById('complete-btn');
        const boostBtn = document.getElementById('boost-btn');
        const tipNotification = document.getElementById('tip-notification');
        const notification = document.getElementById('notification');
        const pauseMenu = document.getElementById('pause-menu');

        function initGame() {
            // –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x87CEEB, 50, 500);
            
            // –°–æ–∑–¥–∞–µ–º –∫–∞–º–µ—Ä—É
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 20, 30);
            
            // –°–æ–∑–¥–∞–µ–º —Ä–µ–Ω–¥–µ—Ä–µ—Ä
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('game-container').appendChild(renderer.domElement);
            
            // –û—Å–≤–µ—â–µ–Ω–∏–µ
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 100, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // –°–æ–∑–¥–∞–µ–º –≥–æ—Ä–æ–¥ –ú–æ—Å–∫–≤—É
            createMoscow();
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—à–∏–Ω—É
            createCar();
            
            // –°–æ–∑–¥–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –∑–∞–∫–∞–∑–æ–≤
            createMarkers();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –≤ —Ç–µ–ª–µ—Ñ–æ–Ω
            loadOrders();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
            updatePhoneTime();
            setInterval(updatePhoneTime, 60000);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            window.addEventListener('resize', onWindowResize);
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            setTimeout(() => {
                showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!', 
                    '–í—ã - –∫—É—Ä—å–µ—Ä –≤ –ú–æ—Å–∫–≤–µ!\n' +
                    '1. –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ\n' + 
                    '2. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑"\n' +
                    '3. –°–ª–µ–¥—É–π—Ç–µ –ø–æ —Å—Ç—Ä–µ–ª–∫–µ –∫ —Ç–æ—á–∫–µ\n' +
                    '4. –î–æ—Å—Ç–∞–≤—å—Ç–µ –±—ã—Å—Ç—Ä–æ –¥–ª—è —á–∞–µ–≤—ã—Ö!');
            }, 1000);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
            animate();
        }

        function createMoscow() {
            // –ó–µ–º–ª—è
            const groundGeometry = new THREE.PlaneGeometry(400, 400, 50, 50);
            const groundMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x2d5a27,
                side: THREE.DoubleSide
            });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // –¢–µ–∫—Å—Ç—É—Ä–∞ —Ç—Ä–∞–≤—ã
            const grassGeometry = new THREE.PlaneGeometry(400, 400);
            const grassMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x3a7c3a,
                transparent: true,
                opacity: 0.3
            });
            const grass = new THREE.Mesh(grassGeometry, grassMaterial);
            grass.rotation.x = -Math.PI / 2;
            grass.position.y = 0.01;
            scene.add(grass);
            
            // –î–æ—Ä–æ–≥–∏ - –ö–æ–ª—å—Ü–µ–≤–∞—è (–ú–ö–ê–î)
            createRingRoad(150, 8, 0x333333);
            
            // –î–æ—Ä–æ–≥–∏ - –¢—Ä–µ—Ç—å–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω–æ–µ –∫–æ–ª—å—Ü–æ
            createRingRoad(100, 6, 0x444444);
            
            // –î–æ—Ä–æ–≥–∏ - –°–∞–¥–æ–≤–æ–µ –∫–æ–ª—å—Ü–æ
            createRingRoad(60, 5, 0x555555);
            
            // –ì–ª–∞–≤–Ω—ã–µ –º–∞–≥–∏—Å—Ç—Ä–∞–ª–∏
            createMainRoads();
            
            // –°–æ–∑–¥–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Ä–∞–π–æ–Ω—ã –ú–æ—Å–∫–≤—ã
            createDistrict(-120, -120, 'panelki', 15);  // –°–ø–∞–ª—å–Ω—ã–µ —Ä–∞–π–æ–Ω—ã
            createDistrict(120, -100, 'business', 10);  // –ë–∏–∑–Ω–µ—Å-—Ü–µ–Ω—Ç—Ä—ã
            createDistrict(-100, 120, 'historic', 12);  // –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä
            createDistrict(100, 100, 'modern', 8);      // –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–π–æ–Ω—ã
            
            // –ú–æ—Å–∫–≤–∞-–°–∏—Ç–∏ (–Ω–µ–±–æ—Å–∫—Ä–µ–±—ã)
            createMoscowCity(-80, -70);
            
            // –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å
            createRedSquare(40, 60);
            
            // –ü–∞—Ä–∫–∏
            createPark(-30, 80, 30);
            createPark(120, -50, 25);
            
            // –†–µ–∫–∞ –ú–æ—Å–∫–≤–∞
            createRiver();
        }

        function createRingRoad(radius, width, color) {
            const roadGeometry = new THREE.RingGeometry(radius - width/2, radius + width/2, 64);
            const roadMaterial = new THREE.MeshLambertMaterial({ color: color });
            const road = new THREE.Mesh(roadGeometry, roadMaterial);
            road.rotation.x = -Math.PI / 2;
            road.position.y = 0.02;
            road.receiveShadow = true;
            scene.add(road);
            
            // –†–∞–∑–º–µ—Ç–∫–∞
            const lineGeometry = new THREE.RingGeometry(radius - 0.2, radius + 0.2, 64);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffff00 });
            const line = new THREE.Line(lineGeometry, lineMaterial);
            line.rotation.x = -Math.PI / 2;
            line.position.y = 0.03;
            scene.add(line);
        }

        function createMainRoads() {
            const roadMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffff00 });
            
            // –†–∞–¥–∏–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            const angles = [0, 45, 90, 135, 180, 225, 270, 315];
            
            angles.forEach(angle => {
                const rad = angle * Math.PI / 180;
                const length = 200;
                const width = 6;
                
                // –î–æ—Ä–æ–≥–∞
                const roadGeometry = new THREE.PlaneGeometry(width, length);
                const road = new THREE.Mesh(roadGeometry, roadMaterial);
                road.rotation.x = -Math.PI / 2;
                road.rotation.z = rad;
                road.position.set(
                    Math.cos(rad) * length/2,
                    0.02,
                    Math.sin(rad) * length/2
                );
                road.receiveShadow = true;
                scene.add(road);
                
                // –†–∞–∑–º–µ—Ç–∫–∞
                const points = [];
                for (let i = -length/2 + 10; i < length/2; i += 20) {
                    points.push(new THREE.Vector3(
                        Math.cos(rad) * i,
                        0.03,
                        Math.sin(rad) * i
                    ));
                    points.push(new THREE.Vector3(
                        Math.cos(rad) * (i + 10),
                        0.03,
                        Math.sin(rad) * (i + 10)
                    ));
                }
                
                const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);
                const line = new THREE.Line(lineGeometry, lineMaterial);
                scene.add(line);
            });
        }

        function createDistrict(x, z, type, count) {
            const buildingTypes = {
                'panelki': { colors: [0x8B7355, 0xA0522D, 0x8B4513], heights: [20, 30, 25] },
                'business': { colors: [0x4682B4, 0x4169E1, 0x1E90FF], heights: [40, 50, 60] },
                'historic': { colors: [0xB8860B, 0xDAA520, 0xFFD700], heights: [15, 20, 25] },
                'modern': { colors: [0x2F4F4F, 0x708090, 0x778899], heights: [30, 35, 40] }
            };
            
            const typeInfo = buildingTypes[type];
            
            for (let i = 0; i < count; i++) {
                const width = 8 + Math.random() * 12;
                const height = typeInfo.heights[Math.floor(Math.random() * typeInfo.heights.length)];
                const depth = 8 + Math.random() * 12;
                const color = typeInfo.colors[Math.floor(Math.random() * typeInfo.colors.length)];
                
                const geometry = new THREE.BoxGeometry(width, height, depth);
                const material = new THREE.MeshLambertMaterial({ color: color });
                const building = new THREE.Mesh(geometry, material);
                
                const angle = Math.random() * Math.PI * 2;
                const distance = 30 + Math.random() * 40;
                
                building.position.set(
                    x + Math.cos(angle) * distance,
                    height/2,
                    z + Math.sin(angle) * distance
                );
                
                building.castShadow = true;
                building.receiveShadow = true;
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–∫–Ω–∞
                addWindows(building, width, height, depth);
                
                scene.add(building);
            }
        }

        function addWindows(building, width, height, depth) {
            const windowMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xFFFF00,
                emissive: 0x222200
            });
            
            const windowSize = 0.8;
            const spacing = 2;
            
            // –û–∫–Ω–∞ –Ω–∞ –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω–∞—Ö
            for (let y = 1; y < height - 2; y += spacing) {
                for (let x = -width/2 + 1; x < width/2 - 1; x += spacing) {
                    if (Math.random() > 0.4) {
                        const windowGeometry = new THREE.PlaneGeometry(windowSize, windowSize);
                        const window = new THREE.Mesh(windowGeometry, windowMaterial);
                        window.position.set(x, y, depth/2 + 0.1);
                        building.add(window);
                        
                        const window2 = new THREE.Mesh(windowGeometry, windowMaterial);
                        window2.position.set(x, y, -depth/2 - 0.1);
                        window2.rotation.y = Math.PI;
                        building.add(window2);
                    }
                }
                
                for (let z = -depth/2 + 1; z < depth/2 - 1; z += spacing) {
                    if (Math.random() > 0.4) {
                        const windowGeometry = new THREE.PlaneGeometry(windowSize, windowSize);
                        const window = new THREE.Mesh(windowGeometry, windowMaterial);
                        window.position.set(width/2 + 0.1, y, z);
                        window.rotation.y = Math.PI / 2;
                        building.add(window);
                        
                        const window2 = new THREE.Mesh(windowGeometry, windowMaterial);
                        window2.position.set(-width/2 - 0.1, y, z);
                        window2.rotation.y = -Math.PI / 2;
                        building.add(window2);
                    }
                }
            }
        }

        function createMoscowCity(x, z) {
            const towers = [
                { height: 300, width: 30, color: 0x1E90FF },
                { height: 250, width: 25, color: 0x4169E1 },
                { height: 280, width: 28, color: 0x0000CD },
                { height: 320, width: 32, color: 0x00BFFF },
                { height: 270, width: 27, color: 0x4682B4 }
            ];
            
            towers.forEach((tower, i) => {
                const angle = (i / towers.length) * Math.PI * 2;
                const distance = 20;
                
                const geometry = new THREE.BoxGeometry(tower.width, tower.height, tower.width);
                const material = new THREE.MeshLambertMaterial({ 
                    color: tower.color,
                    metalness: 0.7,
                    roughness: 0.2
                });
                
                const building = new THREE.Mesh(geometry, material);
                building.position.set(
                    x + Math.cos(angle) * distance,
                    tower.height/2,
                    z + Math.sin(angle) * distance
                );
                
                building.castShadow = true;
                scene.add(building);
                
                // –°—Ç–µ–∫–ª—è–Ω–Ω—ã–µ —Å—Ç–µ–Ω—ã
                const glassGeometry = new THREE.BoxGeometry(tower.width - 2, tower.height - 5, tower.width - 2);
                const glassMaterial = new THREE.MeshLambertMaterial({
                    color: 0x87CEEB,
                    transparent: true,
                    opacity: 0.3
                });
                
                const glass = new THREE.Mesh(glassGeometry, glassMaterial);
                glass.position.y = 2.5;
                building.add(glass);
            });
        }

        function createRedSquare(x, z) {
            // –ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å
            const squareGeometry = new THREE.PlaneGeometry(40, 30);
            const squareMaterial = new THREE.MeshLambertMaterial({ color: 0xB22222 });
            const square = new THREE.Mesh(squareGeometry, squareMaterial);
            square.rotation.x = -Math.PI / 2;
            square.position.set(x, 0.01, z);
            scene.add(square);
            
            // –ö—Ä–µ–º–ª—å
            const wallGeometry = new THREE.BoxGeometry(50, 15, 5);
            const wallMaterial = new THREE.MeshLambertMaterial({ color: 0xFFD700 });
            
            for (let i = 0; i < 4; i++) {
                const wall = new THREE.Mesh(wallGeometry, wallMaterial);
                const angle = (i * Math.PI) / 2;
                
                wall.position.set(
                    x + Math.cos(angle) * 22.5,
                    7.5,
                    z + Math.sin(angle) * 17.5
                );
                wall.rotation.y = angle;
                wall.castShadow = true;
                scene.add(wall);
            }
            
            // –°–ø–∞—Å—Å–∫–∞—è –±–∞—à–Ω—è
            const towerGeometry = new THREE.BoxGeometry(8, 40, 8);
            const towerMaterial = new THREE.MeshLambertMaterial({ color: 0xFF4500 });
            const tower = new THREE.Mesh(towerGeometry, towerMaterial);
            tower.position.set(x, 20, z - 10);
            tower.castShadow = true;
            scene.add(tower);
        }

        function createPark(x, z, size) {
            const parkGeometry = new THREE.PlaneGeometry(size * 2, size * 2);
            const parkMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            const park = new THREE.Mesh(parkGeometry, parkMaterial);
            park.rotation.x = -Math.PI / 2;
            park.position.set(x, 0.01, z);
            scene.add(park);
            
            // –î–µ—Ä–µ–≤—å—è
            for (let i = 0; i < 20; i++) {
                const tree = createTree();
                const angle = Math.random() * Math.PI * 2;
                const distance = Math.random() * size;
                
                tree.position.set(
                    x + Math.cos(angle) * distance,
                    0,
                    z + Math.sin(angle) * distance
                );
                scene.add(tree);
            }
        }

        function createTree() {
            const treeGroup = new THREE.Group();
            
            // –°—Ç–≤–æ–ª
            const trunkGeometry = new THREE.CylinderGeometry(0.5, 0.7, 3, 8);
            const trunkMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
            treeGroup.add(trunk);
            
            // –ö—Ä–æ–Ω–∞
            const crownGeometry = new THREE.SphereGeometry(3, 8, 8);
            const crownMaterial = new THREE.MeshLambertMaterial({ color: 0x228B22 });
            const crown = new THREE.Mesh(crownGeometry, crownMaterial);
            crown.position.y = 3;
            treeGroup.add(crown);
            
            return treeGroup;
        }

        function createRiver() {
            const riverGeometry = new THREE.PlaneGeometry(400, 30);
            const riverMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x4682B4,
                transparent: true,
                opacity: 0.7
            });
            const river = new THREE.Mesh(riverGeometry, riverMaterial);
            river.rotation.x = -Math.PI / 2;
            river.position.set(0, 0.02, 0);
            river.rotation.z = Math.PI / 4;
            scene.add(river);
        }

        function createCar() {
            const carGroup = new THREE.Group();
            
            // –ö—É–∑–æ–≤
            const bodyGeometry = new THREE.BoxGeometry(2.5, 1, 5);
            const bodyMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xFF0000,
                metalness: 0.3,
                roughness: 0.4
            });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            carGroup.add(body);
            
            // –ö–∞–±–∏–Ω–∞
            const cabinGeometry = new THREE.BoxGeometry(2, 1.2, 2);
            const cabinMaterial = new THREE.MeshLambertMaterial({ color: 0x111111 });
            const cabin = new THREE.Mesh(cabinGeometry, cabinMaterial);
            cabin.position.y = 0.9;
            cabin.position.z = -1;
            carGroup.add(cabin);
            
            // –õ–æ–±–æ–≤–æ–µ —Å—Ç–µ–∫–ª–æ
            const windshieldGeometry = new THREE.PlaneGeometry(1.8, 0.8);
            const windshieldMaterial = new THREE.MeshLambertMaterial({ 
                color: 0x87CEEB,
                transparent: true,
                opacity: 0.3
            });
            const windshield = new THREE.Mesh(windshieldGeometry, windshieldMaterial);
            windshield.position.set(0, 1.3, 0.1);
            windshield.rotation.x = 0.3;
            carGroup.add(windshield);
            
            // –ö–æ–ª–µ—Å–∞
            const wheelGeometry = new THREE.CylinderGeometry(0.4, 0.4, 0.3, 16);
            const wheelMaterial = new THREE.MeshLambertMaterial({ color: 0x111111 });
            
            const positions = [
                { x: 0.8, y: -0.5, z: 1.5 },
                { x: -0.8, y: -0.5, z: 1.5 },
                { x: 0.8, y: -0.5, z: -1.5 },
                { x: -0.8, y: -0.5, z: -1.5 }
            ];
            
            positions.forEach(pos => {
                const wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
                wheel.rotation.z = Math.PI / 2;
                wheel.position.set(pos.x, pos.y, pos.z);
                carGroup.add(wheel);
            });
            
            // –§–∞—Ä—ã
            const lightGeometry = new THREE.SphereGeometry(0.2, 8, 8);
            const lightMaterial = new THREE.MeshLambertMaterial({ 
                color: 0xFFFF00,
                emissive: 0xFFFF00,
                emissiveIntensity: 0.5
            });
            
            const frontLight1 = new THREE.Mesh(lightGeometry, lightMaterial);
            frontLight1.position.set(0.6, 0.2, 2.5);
            carGroup.add(frontLight1);
            
            const frontLight2 = new THREE.Mesh(lightGeometry, lightMaterial);
            frontLight2.position.set(-0.6, 0.2, 2.5);
            carGroup.add(frontLight2);
            
            carGroup.position.set(0, 0.8, 0);
            carGroup.castShadow = true;
            scene.add(carGroup);
            car = carGroup;
        }

        function createMarkers() {
            gameState.orders.forEach(order => {
                // –ú–∞—Ä–∫–µ—Ä –Ω–∞ –∫–∞—Ä—Ç–µ
                const marker = document.createElement('div');
                marker.className = 'map-marker';
                marker.id = 'marker-' + order.id;
                
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = `–ó–∞–∫–∞–∑ #${order.id}`;
                marker.appendChild(label);
                
                document.getElementById('ui').appendChild(marker);
                
                // –ó–æ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∏
                const zone = document.createElement('div');
                zone.className = 'delivery-zone';
                zone.id = 'zone-' + order.id;
                zone.style.width = (order.zoneRadius * 2) + 'px';
                zone.style.height = (order.zoneRadius * 2) + 'px';
                document.getElementById('ui').appendChild(zone);
            });
        }

        function loadOrders() {
            ordersListEl.innerHTML = '';
            gameState.orders.forEach(order => {
                const orderEl = document.createElement('div');
                orderEl.className = 'order';
                orderEl.innerHTML = `
                    <div class="order-header">
                        <div class="order-title">–ó–∞–∫–∞–∑ #${order.id}</div>
                        <div class="order-reward">${order.reward} ‚ÇΩ</div>
                    </div>
                    <div class="order-address">${order.address}</div>
                    <div class="order-time">${order.time} —Å–µ–∫</div>
                `;
                orderEl.addEventListener('click', () => selectOrder(order.id));
                ordersListEl.appendChild(orderEl);
            });
        }

        function selectOrder(orderId) {
            document.querySelectorAll('.order').forEach(el => {
                el.classList.remove('active');
            });
            
            const orderEl = document.querySelector(`.order:nth-child(${orderId})`);
            if (orderEl) {
                orderEl.classList.add('active');
                gameState.currentOrder = gameState.orders.find(o => o.id === orderId);
                acceptBtn.disabled = false;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä –∑–∞–∫–∞–∑–∞
                updateMarkers();
            }
        }

        function updateMarkers() {
            gameState.orders.forEach(order => {
                const marker = document.getElementById('marker-' + order.id);
                const zone = document.getElementById('zone-' + order.id);
                
                if (marker && zone) {
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –º–∞—Ä–∫–µ—Ä—ã
                    marker.style.display = 'block';
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –º–∞—Ä–∫–µ—Ä–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                    const screenPos = worldToScreen(order.location.x, 0, order.location.z);
                    if (screenPos) {
                        marker.style.left = screenPos.x + 'px';
                        marker.style.top = screenPos.y + 'px';
                        
                        zone.style.left = screenPos.x + 'px';
                        zone.style.top = screenPos.y + 'px';
                    }
                    
                    // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑
                    if (gameState.currentOrder && gameState.currentOrder.id === order.id) {
                        marker.classList.add('delivery');
                        zone.style.display = 'block';
                    } else {
                        marker.classList.remove('delivery');
                        zone.style.display = 'none';
                    }
                }
            });
        }

        function worldToScreen(x, y, z) {
            if (!camera) return null;
            
            const vector = new THREE.Vector3(x, y, z);
            vector.project(camera);
            
            const screenX = (vector.x * 0.5 + 0.5) * window.innerWidth;
            const screenY = (-vector.y * 0.5 + 0.5) * window.innerHeight;
            
            return { x: screenX, y: screenY };
        }

        function acceptOrder() {
            if (!gameState.currentOrder) {
                showNotification('–û—à–∏–±–∫–∞', '–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ!');
                return;
            }
            
            gameState.deliveryTime = gameState.currentOrder.time;
            gameState.maxDeliveryTime = gameState.currentOrder.time;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            directionPointer.style.display = 'block';
            distanceDisplay.style.display = 'block';
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
            startDeliveryTimer();
            
            acceptBtn.disabled = true;
            completeBtn.disabled = false;
            
            showNotification('–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!', 
                `–î–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–∞:\n${gameState.currentOrder.address}\n\n` +
                `–í—Ä–µ–º—è: ${gameState.currentOrder.time} —Å–µ–∫\n` +
                `–°–ª–µ–¥—É–π—Ç–µ –ø–æ —Å—Ç—Ä–µ–ª–∫–µ –∫ —Ç–æ—á–∫–µ –¥–æ—Å—Ç–∞–≤–∫–∏!`);
        }

        function startDeliveryTimer() {
            if (gameState.deliveryTimer) {
                clearInterval(gameState.deliveryTimer);
            }
            
            gameState.deliveryTimer = setInterval(() => {
                gameState.deliveryTime--;
                
                const minutes = Math.floor(gameState.deliveryTime / 60);
                const seconds = gameState.deliveryTime % 60;
                timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                // –ú–µ–Ω—è–µ–º —Ü–≤–µ—Ç –ø—Ä–∏ –º–∞–ª–æ–º –≤—Ä–µ–º–µ–Ω–∏
                if (gameState.deliveryTime < 30) {
                    timerEl.style.color = '#e94560';
                } else if (gameState.deliveryTime < 60) {
                    timerEl.style.color = '#ffaa00';
                } else {
                    timerEl.style.color = '#4cc9f0';
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ä–µ–º—è
                if (gameState.deliveryTime <= 0) {
                    clearInterval(gameState.deliveryTimer);
                    failDelivery();
                }
            }, 1000);
        }

        function updateDirectionPointer() {
            if (!gameState.currentOrder || !car) return;
            
            const order = gameState.currentOrder;
            
            // –í–µ–∫—Ç–æ—Ä –æ—Ç –º–∞—à–∏–Ω—ã –∫ —Ü–µ–ª–∏
            const dx = order.location.x - car.position.x;
            const dz = order.location.z - car.position.z;
            
            // –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ
            const distance = Math.sqrt(dx * dx + dz * dz);
            distanceDisplay.textContent = Math.round(distance) + ' –º';
            
            // –£–≥–æ–ª –∫ —Ü–µ–ª–∏
            let targetAngle = Math.atan2(dx, dz);
            
            // –£–≥–æ–ª –º–∞—à–∏–Ω—ã
            const carAngle = car.rotation.y;
            
            // –†–∞–∑–Ω–∏—Ü–∞ —É–≥–ª–æ–≤
            let angleDiff = targetAngle - carAngle;
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —É–≥–æ–ª
            while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
            while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;
            
            // –ü–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å
            directionPointer.style.transform = `translate(-50%, -50%) rotate(${angleDiff}rad)`;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –ø—Ä–∏ –±–ª–∏–∑–∫–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
            if (distance < 20) {
                directionPointer.style.display = 'none';
                distanceDisplay.style.display = 'none';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø—Ä–∏–±—ã—Ç–∏–∏
                if (distance < 15 && !completeBtn.disabled) {
                    showTip('–í—ã –Ω–∞ –º–µ—Å—Ç–µ! –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å"');
                }
            } else {
                directionPointer.style.display = 'block';
                distanceDisplay.style.display = 'block';
            }
        }

        function completeDelivery() {
            if (!gameState.currentOrder) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ç–æ—á–∫–∏
            const dx = gameState.currentOrder.location.x - car.position.x;
            const dz = gameState.currentOrder.location.z - car.position.z;
            const distance = Math.sqrt(dx * dx + dz * dz);
            
            if (distance > gameState.currentOrder.zoneRadius) {
                showNotification('–°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ!', 
                    `–ü–æ–¥—ä–µ–∑–∂–∞–π—Ç–µ –±–ª–∏–∂–µ –∫ —Ç–æ—á–∫–µ!\n` +
                    `–¢–µ–∫—É—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ: ${Math.round(distance)} –º\n` +
                    `–ù—É–∂–Ω–æ –±—ã—Ç—å –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö: ${gameState.currentOrder.zoneRadius} –º`);
                return;
            }
            
            // –†–∞—Å—á–µ—Ç –Ω–∞–≥—Ä–∞–¥—ã
            const timeBonus = gameState.deliveryTime / gameState.maxDeliveryTime;
            let tip = 0;
            let ratingChange = 0;
            
            if (timeBonus > 0.8) {
                tip = Math.floor(gameState.currentOrder.reward * 0.3);
                ratingChange = 0.2;
                showTip(`–û—Ç–ª–∏—á–Ω–æ! –°—É–ø–µ—Ä –±—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞! +${tip}‚ÇΩ —á–∞–µ–≤—ã—Ö`);
            } else if (timeBonus > 0.5) {
                tip = Math.floor(gameState.currentOrder.reward * 0.15);
                ratingChange = 0.1;
                showTip(`–•–æ—Ä–æ—à–æ! –ë—ã—Å—Ç—Ä–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞! +${tip}‚ÇΩ —á–∞–µ–≤—ã—Ö`);
            } else if (timeBonus > 0.2) {
                tip = Math.floor(gameState.currentOrder.reward * 0.05);
                ratingChange = 0;
                showTip(`–£—Å–ø–µ–ª–∏! –í–æ–≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∏–ª–∏! +${tip}‚ÇΩ —á–∞–µ–≤—ã—Ö`);
            } else {
                ratingChange = -0.2;
                showTip('–ï–ª–µ —É—Å–ø–µ–ª–∏! –í —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ! –ë–µ–∑ —á–∞–µ–≤—ã—Ö');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            gameState.balance += gameState.currentOrder.reward + tip;
            gameState.delivered++;
            updateRating(ratingChange);
            
            // –°–∫—Ä—ã–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å
            directionPointer.style.display = 'none';
            distanceDisplay.style.display = 'none';
            
            // –°–∫—Ä—ã–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä
            const marker = document.getElementById('marker-' + gameState.currentOrder.id);
            const zone = document.getElementById('zone-' + gameState.currentOrder.id);
            if (marker) marker.style.display = 'none';
            if (zone) zone.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –∑–∞–∫–∞–∑
            clearInterval(gameState.deliveryTimer);
            gameState.currentOrder = null;
            timerEl.textContent = '--:--';
            timerEl.style.color = '#4cc9f0';
            
            acceptBtn.disabled = false;
            completeBtn.disabled = true;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–æ–≤
            if (gameState.delivered >= gameState.orders.length) {
                setTimeout(() => {
                    showNotification('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!', 
                        '–í—ã –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –≤—Å–µ –∑–∞–∫–∞–∑—ã –ú–æ—Å–∫–≤—ã!\n' +
                        `–ò—Ç–æ–≥–æ–≤—ã–π –±–∞–ª–∞–Ω—Å: ${gameState.balance}‚ÇΩ\n` +
                        `–†–µ–π—Ç–∏–Ω–≥: ${gameState.rating.toFixed(1)}/5\n\n` +
                        '–ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥...');
                    setTimeout(restartGame, 5000);
                }, 1000);
            }
        }

        function failDelivery() {
            showNotification('–í—Ä–µ–º—è –≤—ã—à–ª–æ!', '–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω. –í—ã –Ω–µ —É—Å–ø–µ–ª–∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –≤–æ–≤—Ä–µ–º—è.');
            updateRating(-0.3);
            
            if (gameState.currentOrder) {
                const marker = document.getElementById('marker-' + gameState.currentOrder.id);
                const zone = document.getElementById('zone-' + gameState.currentOrder.id);
                if (marker) marker.style.display = 'none';
                if (zone) zone.style.display = 'none';
                gameState.currentOrder = null;
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å
            directionPointer.style.display = 'none';
            distanceDisplay.style.display = 'none';
            
            timerEl.textContent = '--:--';
            timerEl.style.color = '#4cc9f0';
            acceptBtn.disabled = false;
            completeBtn.disabled = true;
        }

        function useBoost() {
            if (gameState.boosts <= 0) {
                showNotification('–ù–µ—Ç —É—Å–∫–æ—Ä–µ–Ω–∏–π', '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Å–∫–æ—Ä–µ–Ω–∏—è —ç–∫–æ–Ω–æ–º–Ω–æ!');
                return;
            }
            
            if (gameState.isBoostActive) {
                showNotification('–£—Å–∫–æ—Ä–µ–Ω–∏–µ —É–∂–µ –∞–∫—Ç–∏–≤–Ω–æ', '–ü–æ–¥–æ–∂–¥–∏—Ç–µ –ø–æ–∫–∞ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è');
                return;
            }
            
            gameState.boosts--;
            gameState.isBoostActive = true;
            
            boostIndicator.style.display = 'block';
            updateUI();
            
            setTimeout(() => {
                gameState.isBoostActive = false;
                boostIndicator.style.display = 'none';
                showTip('–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å');
            }, 10000);
            
            showTip('–£—Å–∫–æ—Ä–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥!');
        }

        function updateRating(change) {
            gameState.rating += change;
            gameState.rating = Math.max(0, Math.min(5, gameState.rating));
            
            const fullStars = Math.floor(gameState.rating);
            const hasHalfStar = gameState.rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            starsEl.textContent = 
                '‚òÖ'.repeat(fullStars) + 
                (hasHalfStar ? '¬Ω' : '') + 
                '‚òÜ'.repeat(emptyStars);
            
            ratingEl.textContent = gameState.rating.toFixed(1);
        }

        function updateUI() {
            balanceEl.textContent = gameState.balance + ' ‚ÇΩ';
            deliveredEl.textContent = gameState.delivered;
            boostsEl.textContent = gameState.boosts;
            boostBtn.textContent = `–£—Å–∫–æ—Ä–µ–Ω–∏–µ (${gameState.boosts})`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å
            const speedKmh = Math.round(Math.sqrt(
                gameState.velocity.x * gameState.velocity.x + 
                gameState.velocity.z * gameState.velocity.z
            ) * 100);
            
            let displaySpeed = speedKmh;
            if (gameState.isBoostActive) displaySpeed *= 2;
            
            speedometerEl.textContent = displaySpeed + ' –∫–º/—á';
            if (gameState.isBoostActive) {
                speedometerEl.style.color = '#e94560';
            } else if (displaySpeed > 80) {
                speedometerEl.style.color = '#ffaa00';
            } else {
                speedometerEl.style.color = 'white';
            }
        }

        function updatePhoneTime() {
            const now = new Date();
            const timeString = now.getHours().toString().padStart(2, '0') + ':' + 
                             now.getMinutes().toString().padStart(2, '0');
            document.getElementById('phone-time').textContent = timeString;
        }

        function showTip(text) {
            tipNotification.textContent = text;
            tipNotification.style.display = 'block';
            
            setTimeout(() => {
                tipNotification.style.display = 'none';
            }, 3000);
        }

        function showNotification(title, text) {
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-text').textContent = text;
            notification.style.display = 'block';
        }

        function closeNotification() {
            notification.style.display = 'none';
        }

        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
            pauseMenu.style.display = gameState.isPaused ? 'flex' : 'none';
        }

        function restartGame() {
            gameState.balance = 1000;
            gameState.delivered = 0;
            gameState.rating = 5.0;
            gameState.boosts = 3;
            gameState.currentOrder = null;
            gameState.speed = 0;
            gameState.velocity = { x: 0, z: 0 };
            
            if (gameState.deliveryTimer) {
                clearInterval(gameState.deliveryTimer);
            }
            
            updateRating(0);
            updateUI();
            loadOrders();
            
            car.position.set(0, 0.8, 0);
            car.rotation.y = 0;
            
            gameState.playerPosition = { x: 0, z: 0 };
            
            timerEl.textContent = '--:--';
            timerEl.style.color = '#4cc9f0';
            acceptBtn.disabled = false;
            completeBtn.disabled = true;
            
            directionPointer.style.display = 'none';
            distanceDisplay.style.display = 'none';
            
            document.querySelectorAll('.map-marker, .delivery-zone').forEach(el => {
                el.style.display = 'none';
            });
            
            pauseMenu.style.display = 'none';
            gameState.isPaused = false;
            
            showNotification('–ò–≥—Ä–∞ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞', '–£–¥–∞—á–∏ –≤ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–∞—Ö –ø–æ –ú–æ—Å–∫–≤–µ!');
        }

        function showInstructions() {
            showNotification('–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è', 
                'üéÆ –£–ü–†–ê–í–õ–ï–ù–ò–ï:\n' +
                'W/S - –í–ø–µ—Ä–µ–¥/–ù–∞–∑–∞–¥\n' +
                'A/D - –ü–æ–≤–æ—Ä–æ—Ç\n' +
                'E - –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ (–≤–∑—è—Ç—å/—Å–¥–∞—Ç—å)\n' +
                'SPACE - –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —É—Å–∫–æ—Ä–µ–Ω–∏–µ\n' +
                'ESC - –ú–µ–Ω—é –ø–∞—É–∑—ã\n\n' +
                'üéØ –ö–ê–ö –ò–ì–†–ê–¢–¨:\n' +
                '1. –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–∫–∞–∑ –≤ —Ç–µ–ª–µ—Ñ–æ–Ω–µ (–∫–ª–∏–∫)\n' +
                '2. –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑" –∏–ª–∏ E\n' +
                '3. –°–ª–µ–¥—É–π—Ç–µ –ø–æ —Å—Ç—Ä–µ–ª–∫–µ –∫ —Ç–æ—á–∫–µ\n' +
                '4. –ü–æ–¥—ä–µ–∑–∂–∞–π—Ç–µ –±–ª–∏–∑–∫–æ (15–º)\n' +
                '5. –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≤–µ—Ä—à–∏—Ç—å" –∏–ª–∏ E\n\n' +
                'üí∞ –ß–ê–ï–í–´–ï:\n' +
                '–ß–µ–º –±—ã—Å—Ç—Ä–µ–µ –¥–æ—Å—Ç–∞–≤–∫–∞ - —Ç–µ–º –±–æ–ª—å—à–µ —á–∞–µ–≤—ã—Ö!\n' +
                '–°–ª–µ–¥–∏—Ç–µ –∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–º –∏ —Ç–∞–π–º–µ—Ä–æ–º!'
            );
            pauseMenu.style.display = 'none';
            gameState.isPaused = false;
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            updateMarkers();
        }

        function onKeyDown(event) {
            const key = event.key.toLowerCase();
            keys[key] = true;
            
            if (event.key === 'Escape') {
                togglePause();
                event.preventDefault();
            }
            
            if (key === 'e') {
                if (gameState.currentOrder && completeBtn.disabled === false) {
                    completeDelivery();
                } else if (acceptBtn.disabled === false) {
                    acceptOrder();
                }
                event.preventDefault();
            }
            
            if (key === ' ') {
                useBoost();
                event.preventDefault();
            }
        }

        function onKeyUp(event) {
            keys[event.key.toLowerCase()] = false;
        }

        function updateCarMovement() {
            const acceleration = 0.005;
            const friction = 0.98;
            const maxSpeed = 0.2;
            const turnSpeed = 0.05;
            
            // –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å –±—É—Å—Ç–æ–º
            let currentAcceleration = acceleration;
            let currentMaxSpeed = maxSpeed;
            
            if (gameState.isBoostActive) {
                currentAcceleration *= 2;
                currentMaxSpeed *= 2;
            }
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –≤–ø–µ—Ä–µ–¥/–Ω–∞–∑–∞–¥
            if (keys['w'] || keys['arrowup']) {
                gameState.velocity.x -= Math.sin(car.rotation.y) * currentAcceleration;
                gameState.velocity.z -= Math.cos(car.rotation.y) * currentAcceleration;
            }
            
            if (keys['s'] || keys['arrowdown']) {
                gameState.velocity.x += Math.sin(car.rotation.y) * currentAcceleration;
                gameState.velocity.z += Math.cos(car.rotation.y) * currentAcceleration;
            }
            
            // –ü–æ–≤–æ—Ä–æ—Ç
            if (keys['a'] || keys['arrowleft']) {
                car.rotation.y += turnSpeed;
            }
            
            if (keys['d'] || keys['arrowright']) {
                car.rotation.y -= turnSpeed;
            }
            
            // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
            let speed = Math.sqrt(gameState.velocity.x * gameState.velocity.x + 
                                 gameState.velocity.z * gameState.velocity.z);
            
            if (speed > currentMaxSpeed) {
                gameState.velocity.x = (gameState.velocity.x / speed) * currentMaxSpeed;
                gameState.velocity.z = (gameState.velocity.z / speed) * currentMaxSpeed;
            }
            
            // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–µ–Ω–∏—è
            gameState.velocity.x *= friction;
            gameState.velocity.z *= friction;
            
            // –î–≤–∏–∂–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
            car.position.x += gameState.velocity.x;
            car.position.z += gameState.velocity.z;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –∏–≥—Ä–æ–∫–∞
            gameState.playerPosition.x = car.position.x;
            gameState.playerPosition.z = car.position.z;
            
            // –ù–∞–∫–ª–æ–Ω –º–∞—à–∏–Ω—ã –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ
            const turnIntensity = Math.abs(gameState.velocity.x) + Math.abs(gameState.velocity.z);
            car.rotation.z = -gameState.velocity.x * 0.1;
            car.rotation.x = gameState.velocity.z * 0.05;
            
            // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é (—á—Ç–æ–±—ã –Ω–µ –≤—ã–µ—Ö–∞—Ç—å –∑–∞ –∫–∞—Ä—Ç—É)
            const boundary = 180;
            car.position.x = Math.max(-boundary, Math.min(boundary, car.position.x));
            car.position.z = Math.max(-boundary, Math.min(boundary, car.position.z));
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (gameState.isPaused) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –º–∞—à–∏–Ω—ã
            updateCarMovement();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            updateDirectionPointer();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã
            updateMarkers();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–º–µ—Ä—É
            const cameraDistance = 20;
            const cameraHeight = 10;
            
            camera.position.x = car.position.x + Math.sin(car.rotation.y) * cameraDistance;
            camera.position.z = car.position.z + Math.cos(car.rotation.y) * cameraDistance;
            camera.position.y = cameraHeight;
            camera.lookAt(car.position.x, car.position.y + 2, car.position.z);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI
            updateUI();
            
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>